这是本系列的第二篇文章，响应我的twitter博文https://x.com/Jerrylee778899/status/1983721492484649154
在这篇博文中，我给出了S1在2020-05-07到2025-10-28期间的回测结果，具体结果如下：

# MA 交叉（results/s1/ma_crossover/metrics.json）
total_return（累计收益）：+359.7% （3.5967）
annualized_return（年化）：32.10% （0.3210）
max_drawdown（最大回撤）：-63.07% （-0.6307）
volatility（年化波动）：34.66% （0.3466）
sharpe（夏普）：0.727

# RSI（results/s1/rsi/metrics.json）
total_return：+64.97% （0.6497）
annualized_return：9.57% （0.0957）
max_drawdown：-68.36% （-0.6836）
volatility：33.94% （0.3394）
sharpe：0.356

# MACD（results/s1/macd/metrics.json）
total_return：+418.13% （4.1813）
annualized_return：35.02% （0.3502）
max_drawdown：-52.40% （-0.5240）
volatility：33.46% （0.3346）
sharpe：0.785

为了改善这些策略年化收益和最大回撤，Grok针对S1系列的交易策略改进提出了如下建议：

# 通用改进
1. 增加止损/止盈（Stop-Loss/Take-Profit）：固定5-10%止损，避免大亏；20-30%止盈锁定利润。预期年化微降但回撤减半。
2. 引入仓位管理：用Kelly公式动态调整仓位（f = (p* (b+1) -1)/b，其中p=胜率，b=赔率）。简单版：胜率>50%时仓位1.5倍。
3. 趋势过滤：只在BTC>200日MA时交易（牛市过滤），避开熊市信号。预计回撤降20%。

# 策略级改进
## MA交叉策略
这是本系列的第二篇记录，来源于 twitter（https://x.com/Jerrylee778899/status/1983721492484649154）。

本文回顾了 S1 的回测结果（时间区间：2020-05-07 — 2025-10-28），并列出 Grok 给出的改进建议。S2 的目标是把这些建议逐条实现并验证效果。

## S1 回测摘要（关键指标）

| 策略 | total_return | annualized_return | max_drawdown | volatility | sharpe |
|---|---:|---:|---:|---:|---:|
| MA 交叉 (results/s1/ma_crossover/) | +359.7% (3.5967) | 32.10% (0.3210) | -63.07% (-0.6307) | 34.66% (0.3466) | 0.727 |
| RSI (results/s1/rsi/) | +64.97% (0.6497) | 9.57% (0.0957) | -68.36% (-0.6836) | 33.94% (0.3394) | 0.356 |
| MACD (results/s1/macd/) | +418.13% (4.1813) | 35.02% (0.3502) | -52.40% (-0.5240) | 33.46% (0.3346) | 0.785 |

> 注：上述指标来自 `results/s1/<strategy>/metrics.json`。

## 改进目标（总体方向）

S2 将优先实现下列改进以提升“风险调整后收益”（目标：降低最大回撤并提升或稳定年化收益、提高夏普）：

- 增加风险管理（止损、止盈、仓位限制）。
- 引入趋势过滤（如 200 日均线）以避免在熊市频繁进场。
- 在信号层面加入额外过滤（成交量、RSI/MACD 互证、零轴过滤等）。
- 以实验方式调参（网格搜索或简单回测扫描）并记录每次变更的结果。

## 具体改进建议（来自 Grok，作为 S2 的初始任务列表）

### 通用改进

1. 止损 / 止盈（Stop-Loss / Take-Profit）
	- 示例：固定 5–10% 止损，20–30% 止盈。
	- 作用：在大幅回撤时限制损失，预期能显著降低最大回撤（trade-off：年化可能小幅下降）。

2. 仓位管理
	- 可用 Kelly 公式或简单规则（例如胜率 > 50% 时仓位乘以 1.5；或固定分批建仓）。
	- 作用：减少单笔风险暴露，改善回撤/波动表现。

3. 趋势过滤
	- 仅在 BTC > 200 日均线时允许做多，避免熊市信号。

### 策略级改进（任务级别说明）

#### MA 交叉

- 用 EMA 替换 SMA（提高对价格变动的敏感度）。
- 增加成交量过滤：仅当当日成交量 > 20 日均量时，信号有效。
- 结合 200 日 MA 做趋势过滤（只在多头市场执行买入）。

预期效果（估计）：年化上升 ~5–10%，最大回撤显著下降（示例目标：≤ 40%），夏普提升。

#### RSI 策略

- 动态阈值：在牛市采用更宽松的买入阈值（如 RSI<40 买入，>60 卖出），在熊市反向或更保守。
- 只在价格 > MA50 时才考虑买入（MA 过滤）。
- 加入背离检测（Divergence）作为额外卖出条件。

预期效果：改善年化与回撤，夏普中等提升。

#### MACD 策略

- 零轴过滤：只有当 MACD > 0 时才考虑多头信号，避免在负趋势中回补多头。
- 与 RSI 互证：MACD 买信号 + RSI < 50 做二次确认。
- 尝试参数微调（例如 11,24,8）以提高灵敏度并在样本上进行验证。

预期效果：在保证收益的同时进一步降低回撤，目标夏普 > 1.0（需验证）。

## S2 的工作计划（短期）

1. 为每条策略实现一个分支版本（例如 `S2/strategies/ma_crossover_v2.py`），逐步加入上面的改进；
2. 对每次修改运行统一回测（`S2/run_all.py` 或复用 `S1/run_all.py`）并把结果写入 `results/s2/<strategy>/`；
3. 把每次实验的 `metrics.json` 与 `trades.csv` 登记到一个简单的对比表格（CSV）以便横向比较；
4. 根据实验结果选择最有希望的改进组合（进行更细致的参数搜索）。

## 如何参与或复现

1. 按仓库根 README 设置 Python 虚拟环境并安装依赖；
2. 在本地拉取最新代码并运行（示例）：

```bash
source .venv/bin/activate
python3 S1/run_all.py --no-update   # 先用 S1 的 baseline 验证数据
```

3. S2 的工作将在 `S2/` 目录下逐步展开（策略实现、runner、结果目录）。

